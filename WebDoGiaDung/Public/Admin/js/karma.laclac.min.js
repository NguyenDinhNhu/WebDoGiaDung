$(document).ready(function () {
    $('.cSU').click(function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        $.ajax({
            url: "/Admin/User/changeStatus",
            data: { id: id },
            dataType: 'json',
            type: 'POST',
            success: function (res) {
                if (res.Status == 1) {
                    $('.cst' + id).css("text-decoration", "")
                    $('.cst' + id).removeClass("text-danger");
                    $('.cst' + id).addClass("text-success");
                    $('.cst' + id).html("Hoạt Động");
                    toastr.success('Thay đổi trạng thái thành công! id=' + id);
                } else {
                    $('.cst' + id).css("text-decoration", "underline")
                    $('.cst' + id).removeClass("text-success");
                    $('.cst' + id).addClass("text-danger");
                    $('.cst' + id).html("Tạm khóa");
                    toastr.success('Thay đổi trạng thái thành công! id=' + id);
                }
            }
        });
    });

    $('.changeStatusImage').click(function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        $.ajax({
            url: "/Admin/ProductImage/changeStatus",
            data: { id: id },
            dataType: 'json',
            type: 'POST',
            success: function (res) {
                if (res.Status == 1) {
                    $('.cst' + id).css("text-decoration", "")
                    $('.cst' + id).removeClass("text-danger");
                    $('.cst' + id).addClass("text-success");
                    $('.cst' + id).html("Hoạt Động");
                    toastr.success('Thay đổi trạng thái thành công! id=' + id);
                } else {
                    $('.cst' + id).css("text-decoration", "underline")
                    $('.cst' + id).removeClass("text-success");
                    $('.cst' + id).addClass("text-danger");
                    $('.cst' + id).html("Tạm khóa");
                    toastr.success('Thay đổi trạng thái thành công! id=' + id);
                }
            }
        });
    });
});

$(document).ready(function () {
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000
    })
    $('.changeStatus').click(function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        const controller = $(this).data('controller');
        const _this = $(this);
        $.ajax({
            url: "/Admin/" + controller + "/changeStatus",
            data: { id: id },
            dataType: 'json',
            type: 'POST',
            success: function (res) {
                if (res.Status == 1) {
                    _this.prop('checked', true);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi trạng thái thành công! id= ' + id
                    })
                } else {
                    _this.prop('checked', false);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi trạng thái thành công! id= ' + id
                    })
                }
            }
        });
    });
});

$(document).ready(function () {
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000
    })
    $('.changeDiscount').click(function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        const controller = $(this).data('controller');
        const _this = $(this);
        $.ajax({
            url: "/Admin/" + controller + "/changeDiscount",
            data: { id: id },
            dataType: 'json',
            type: 'POST',
            success: function (res) {
                if (res.Discount == 1) {
                    _this.prop('checked', true);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi trạng thái giảm giá thành công! id= ' + id
                    })
                } else {
                    _this.prop('checked', false);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi trạng thái giảm giá thành công! id= ' + id
                    })
                }
            }
        });
    });
});

$(document).ready(function () {
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000
    })
    $('.changeHot').click(function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        const controller = $(this).data('controller');
        const _this = $(this);
        $.ajax({
            url: "/Admin/" + controller + "/changeHot",
            data: { id: id },
            dataType: 'json',
            type: 'POST',
            success: function (res) {
                if (res.IsHot == 1) {
                    _this.prop('checked', true);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi thành công! id= ' + id
                    })
                } else {
                    _this.prop('checked', false);
                    //toastr.success('Thay đổi trạng thái thành công! id=' + id);
                    Toast.fire({
                        icon: 'success',
                        title: 'Thay đổi thành công! id= ' + id
                    })
                }
            }
        });
    });
});

$(window).on('load', function () {
    const mgs_type = $('input[name=mgs_type]').val();
    const msg = $('input[name=mgs]').val();
    if (mgs_type != '' && msg != '') {
        toastr.options.timeOut = 5000;
        switch (mgs_type) {
            case 'success':
                toastr.success(msg);
                break;
            case 'warning':
                toastr.warning(msg);
                break;
            case 'danger':
                toastr.error(msg);
                break;
        }
    }
});


$(document).ready(function () {
    $('#btn-login').click(function (e) {
        e.preventDefault();
        $('.overlay').addClass('d-flex');
        const user = $('input[name=username]').val().trim();
        const pass = $('input[name=password]').val().trim();
        if (user == '' || pass == '') {
            toastr.warning("Vui lòng nhập đủ thông tin trước khi nhấn đăng nhập!");
            $('.overlay').removeClass('d-flex');
        } else {
            $.ajax({
                url: "Login",
                data: { User: user, Pass: pass },
                dataType: 'json',
                type: 'POST',
                success: function (res) {
                    if (res.s == 1) {
                        toastr.error("Tài khoản không chính xác!");
                        $('.overlay').removeClass('d-flex');
                    } else if (res.s == 2) {
                        toastr.error("Mật khẩu không chính xác!");
                        $('.overlay').removeClass('d-flex');
                    } else {
                        window.location.href = "/Admin";
                    }
                }
            })
        }
    })
});

$(document).ready(function () {
    $('.StatusOrder').off('click').on('click', (function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        const status = $(this).data('status');
        $('#modal-secondary').on('shown.bs.modal', function () {
            $(this).find("select").val(status).end();
        });

        $('.changeStatusOrder').off('click').on('click', (function (e) {
            e.preventDefault();
            const optionS = $('#optionStatus').val();
            $.ajax({
                url: "/Admin/Order/changeStatus",
                data: { id: id, op: optionS },
                dataType: 'json',
                type: 'POST',
                success: function (res) {
                    console.log(res)
                    switch (res.s) {
                        case 1:
                            $('.ba' + id).html('Chờ xử lý');
                            $('.ba' + id).addClass('badge-secondary');
                            $('.ba' + id).removeClass('badge-danger');
                            $('.ba' + id).removeClass('badge-info');
                            $('.export-date' + id).html(res.t);
                            $('#modal-secondary').modal('hide');
                            $('#modal-secondary').on('hidden.bs.modal', function () {
                                $(this).find("select").val('1').end();
                            });
                            break;
                        case 2:
                            $('.ba' + id).html('Đang xử lý');
                            $('.ba' + id).addClass('badge-info');
                            $('.ba' + id).removeClass('badge-secondary');
                            $('.ba' + id).removeClass('badge-danger');
                            $('.export-date' + id).html(res.t);
                            $('#modal-secondary').modal('hide');
                            $('#modal-secondary').on('hidden.bs.modal', function () {
                                $(this).find("select").val('1').end();
                            });
                            break;
                        case 3:
                            $('.ba' + id).html('Hoàn thành');
                            $('.ba' + id).addClass('badge-danger');
                            $('.ba' + id).removeClass('badge-secondary');
                            $('.ba' + id).removeClass('badge-info');
                            $('.export-date' + id).html(res.t);
                            $('#modal-secondary').modal('hide');
                            $('#modal-secondary').on('hidden.bs.modal', function () {
                                $(this).find("select").val('1').end();
                            });
                            break;
                        default:
                            break;

                    }
                }
            })
        }))
    }))
});

$(document).on('click', '.add-listImage', function () {
    var id = $('.image-popup').data('id');
    var fd = new FormData();
    var files = $('.listImage').prop('files');
    fd.append("ProductId", id);

    for (let file of files) {
        fd.append("Files", file);
    }
    $.ajax({
        url: '/Admin/productImage/createListImage',
        type: 'POST',
        data: fd,
        processData: false,
        contentType: false,
        success: function (response) {
            if (!response) {
                console.log(respone)
            } else {
                console.log("Thêm mới thành công")
                window.location.reload();
                //toastr.success('Thêm mới ảnh sản phẩm thành công!');
            }
        }
    })
})

//$(document).on('click', '.edit-image', function () {
//    var id = $('.btn-editImage').data('id');
//    var pId = $('.image-popup').data('id');
//    var fd = new FormData();
//    var files = $('.listImage').prop('files');
//    fd.append("ProductId", pId);

//    for (let file of files) {
//        fd.append("Files", file);
//    }
//    console.log(id)
//    $.ajax({
//        url: '/Admin/productImage/editImage',
//        type: 'GET',
//        data: {
//            id,
//            //fd,
//        },
//        dataType: 'json',
//        success: function (response) {
//            if (!response) {
//                console.log(respone);
//            } else {
//                console.log("Sửa ảnh thành công");
//            }
//        }
//    })
//})


$(document).on('click', '.delete-img', function () {
    var id = $('.delete-img').data('id')
    $.ajax({
        url: '/Admin/productImage/delete',
        type: 'GET',
        data: {
            id,
        },
        dataType: 'json',
        success: function (response) {
            if (!response) {
                console.log(respone);
            } else {
                console.log("Xóa thành công");
                window.location.reload();
            }
        }
    })
})

// 404 không gọi được
// 500 lời gọi sai ajax
